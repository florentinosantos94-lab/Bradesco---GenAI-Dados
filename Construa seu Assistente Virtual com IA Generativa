import streamlit as st
import pandas as pd

# CONFIGURA√á√ÉO DA P√ÅGINA (UX)
st.set_page_config(page_title="ByteSafe AI", page_icon="üí∞")

# ESTILO CSS PARA MELHORAR A UX
st.markdown("""
    <style>
    .main { background-color: #f5f7f9; }
    .stButton>button { width: 100%; border-radius: 20px; background-color: #007bff; color: white; }
    </style>
    """, unsafe_allow_html=True)

# L√ìGICA DE C√ÅLCULO FINANCEIRO (BACKEND)
def calcular_investimento(valor_inicial, meses, taxa_anual):
    taxa_mensal = (1 + taxa_anual/100)**(1/12) - 1
    saldo_final = valor_inicial * (1 + taxa_mensal)**meses
    return saldo_final

# PERSIST√äNCIA DE CONTEXTO (MEM√ìRIA)
if "historico" not in st.session_state:
    st.session_state.historico = []

# INTERFACE L√çQUIDA (FRONTEND)
st.title("üí∞ ByteSafe AI")
st.subheader("Seu assistente financeiro personalizado")

# SIDEBAR - PERFIL DO USU√ÅRIO (PERSONALIZA√á√ÉO)
with st.sidebar:
    st.header("Seu Perfil")
    nome = st.text_input("Como quer ser chamado?", "Investidor")
    perfil = st.selectbox("Perfil de Risco", ["Conservador", "Moderado", "Arrojado"])
    st.info(f"Ol√° {nome}, ajustaremos as respostas para o perfil {perfil}.")

# √ÅREA DE CHAT (IA GENERATIVA / NLP)
st.write("---")
user_input = st.text_input("Pergunte algo (ex: 'O que √© CDB?' ou 'Simular investimento')")

if user_input:
    # Simula√ß√£o de Resposta Baseada em Contexto (IA)
    resposta = ""
    entrada_lower = user_input.lower()

    if "cdb" in entrada_lower:
        resposta = "O CDB √© como um empr√©stimo que voc√™ faz ao banco. Em troca, o banco te devolve o dinheiro com juros. Para o seu perfil " + perfil + ", √© uma excelente escolha de baixo risco."
    
    elif "simular" in entrada_lower or "investimento" in entrada_lower:
        st.warning("Vamos fazer uma simula√ß√£o r√°pida!")
        v_ini = st.number_input("Valor Inicial (R$)", value=1000.0)
        tempo = st.slider("Meses", 1, 60, 12)
        taxa = 12.75 # Exemplo de Taxa Selic
        final = calcular_investimento(v_ini, tempo, taxa)
        resposta = f"Com base na taxa de 12.75% a.a., seu saldo ap√≥s {tempo} meses seria de R$ {final:.2f}."

    else:
        resposta = "Desculpe, ainda estou aprendendo sobre esse tema. Tente perguntar sobre CDB, Tesouro Direto ou Simula√ß√µes."

    # Adicionando ao hist√≥rico para persist√™ncia
    st.session_state.historico.append({"user": user_input, "bot": resposta})

# EXIBI√á√ÉO DO HIST√ìRICO (UX DE MENSAGEM)
for chat in reversed(st.session_state.historico):
    st.markdown(f"**üë§ Voc√™:** {chat['user']}")
    st.markdown(f"**ü§ñ ByteSafe AI:** {chat['bot']}")
    st.write("---")

# RODAP√â DE SEGURAN√áA (√âTICA E UX)
st.caption("Aviso: Esta √© uma simula√ß√£o educacional. Sempre consulte um gerente oficial antes de investir.")
